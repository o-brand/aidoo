{% extends 'base.html' %}
{% load static %}

{% block title %}My profile{% endblock %}

{% block head_extra %}
<script src="{% static 'js/htmx-1.8.5.min.js' %}" defer></script>
<script src="{% static 'js/hyperscript-0.9.7.min.js' %}" defer></script>
{% endblock %}

{% block content %}
{% include 'navigation.html' %}

<div class="container my-4">

  <h1>My username: {{ user.username }}</h1>

  {% if bookmarks %}
  <div>
    {% for bookmark in bookmarks %}
      <div class="card mb-2 job-card">
        <div class="card-body">
          <h5 class="card-title"><a href="{% url 'jobdetails' bookmark.job_id.job_id %}">{{bookmark.job_id.job_title }}</a></h5>
          <p class="card-text">
            <i class="bi bi-geo-alt"></i>
            {{ bookmark.job_id.location }}
            &nbsp;
            <i class="bi bi-hourglass-split"></i>
            {% if bookmark.job_id.deadline is not None %}
              {{ bookmark.job_id.deadline | date:'d M Y' }}
            {% else %}
              None
            {% endif %}
            &nbsp;
            <i class="bi bi-stars"></i>
            {{ bookmark.job_id.points }}
          </p>
        </div>
      </div>
    {% endfor %}
  </div>
  <nav aria-label="Page navigation example">
    <ul class="pagination">
      {% if bookmarks.paginator.num_pages > 1 %}
        <li class="page-item">
          {% if bookmarks.has_previous %}
            <a class="page-link"
              href="?bpage=1">
              First</a>
          {% else %}
            <p class="page-link disabled">First</p>
          {% endif %}
        </li>
      {% endif %}
      <li class="page-item">
        {% if bookmarks.has_previous %}
          <a class="page-link"
            href="?bpage={{bookmarks.previous_page_number}}">
            Previous</a>
        {% else %}
          <p class="page-link disabled">Previous</p>
        {% endif %}
      </li>
      <li class="page-item active"><p class="page-link">{{bookmarks.number}}</p></li>
      <li class="page-item">
        {% if bookmarks.has_next %}
          <a class="page-link"
          href="?bpage={{bookmarks.next_page_number}}">
          Next</a>
        {% else %}
          <p class="page-link disabled">Next</p>
        {% endif %}
      </li>
      {% if bookmarks.paginator.num_pages > 1 %}
        <li class="page-item">
          {% if bookmarks.has_next %}
            <a class="page-link"
            href="?bpage={{bookmarks.paginator.num_pages}}">
            Last</a></li>
          {% else %}
            <p class="page-link disabled">Last</p>
          {% endif %}
      {% endif %}
    </ul>
  </nav>
{% else %}
  <p>No jobs posted yet!</p>
{% endif %}

  <div class="tab">
    <button class="tablinks" id="details_tab">Personal details</button>
    <button class="tablinks" id="saved_tab">Bookmarked jobs</button>
    <button class="tablinks" id="applied_tab">Applied jobs</button>
    <button class="tablinks" id="posted_tab">Posted jobs</button>
  </div>

  <div id="details" class="tabcontent">
    <div class="d-flex justify-content-between">
      <h3>Personal details</h3>
      <button class="btn btn-secondary">Edit</button> <!--Not connected to anything yet-->
    </div>
    <p><img src="../static/assets/pfp/{{user.id}}.jpeg" class="profile-pic img-fluid"/></p>
    <p>Real name: {{ user.first_name }} {{ user.last_name }}</p>
    <p>Email address: {{ user.email }}</p>
    <p>Date of birth: {{ user.date_of_birth }}</p>

    <p>Balance: {{ user.balance }} points</p>
    <p>Rating: {{ user.rating }}</p>

    <p>Last logged in: {{ user.last_login }}</p>
    <p>Joined: {{ user.date_joined }}</p>
  </div>

  <div id="saved" class="tabcontent">
    <h3>Bookmarked jobs</h3>
    {% if saved %}
        <div>
            {% for job, time in saved %}
              {% if not job.hidden %}
                <p>
                    <a href="{% url 'jobdetails' job.job_id %}">{{ job.job_title }}</a> ({{job.points}} points)
                    <br>Saved at {{ time }}
                </p>
              {% endif %}
            {% endfor %}
        </div>
    {% else %}
        <p>I don't have any saved jobs.</p>
    {% endif %}
  </div>

  <div id="applied" class="tabcontent">
    <h3>Applied jobs</h3>
    {% if applied %}
      {% for job, status in applied %}
        <div>
          <a href="{% url 'jobdetails' job.job_id %}">{{ job.job_title }}</a> ({{job.points}} points)
          <p>Posted on: {{ job.posting_time }}</p>
          <span>
            {% include 'htmx/job-applied.html' %}
          </span>
          <hr>
        </div>
      {% endfor %}
    {% else %}
        <p>I haven't applied for any jobs.</p>
    {% endif %}
  </div>

  <div id="posted" class="tabcontent">
    <h3>Posted jobs</h3>
    {% if posted %}
      {% for job, applicants in posted %}
        <div>
          <a href="{% url 'jobdetails' job.job_id %}">{{ job.job_title }}</a> ({{job.points}} points)
          <p>Posted on: {{ job.posting_time }}</p>
            <span>
              {% include 'htmx/job-applicants.html' %}
            </span>
        </div>
        <hr>
      {% endfor %}
    {% else %}
        <p>I haven't posted any jobs.</p>
    {% endif %}
  </div>
  <br/>
  <p><a href="{% url 'home' %}">Go back</a></p>
</div>

<script src="{% static 'js/private.js' %}"></script>
{% endblock %}
