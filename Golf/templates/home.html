{% extends 'base-modal.html' %}
{% load static %}

{% block title %}Home{% endblock %}

{% block content %}
{% include 'navigation.html' %}

<div class="container">
  <div class="hello text-center justify-content-center">
    <h1>Hi {{ me.username }}!</h1>
    {% if jobs_count == 0 %}
      <p>There are no available jobs for this search term.</p>
    {% elif jobs_count == 1 %}
      <p>You can see the available job here. </p>
    {% else %}
      <p>You can see the {{jobs_count}} available jobs here. </p>
    {% endif %}
    <button class="btn btn-secondary post-button" hx-get="{% url 'post' %}" hx-target="#dialog">
      <i class="bi bi-pencil-square"></i>
    </button>
    <a href="{% url 'chat' %}" class="btn btn-secondary chat-button">
      <i class="bi bi-chat-left"></i>
    </a>
    <a href="{% url 'store' %}" class="btn btn-secondary shop-button">
      <i class="bi bi-bag"></i>
    </a>
  </div>
  <form class="searchform d-flex justify-content-center" method ="get">
    <input class="searchbar" type="text" value='{{request.GET.search}}' name="search"/>
    <button class="btn btn-primary" type="submit">Search</button>
  </form>
  <div class="row d-flex justify-content-center">
    <div class="col jobs-scroll mb-5">
      {% for job in jobs %}
        <div class="card job-card mb-2">
          <div class="card-body">
            <div class="card-title d-flex justify-content-between mb-0">
              <h4><a href="{% url 'jobdetails' job.job_id %}">{{ job.job_title }}</a></h4>
              <div class="dropdown">
                <button class="btn btn-secondary"
                  type="button" id="dropdownMenuButton" data-bs-toggle="dropdown"
                  aria-haspopup="true" aria-expanded="false">
                  <i class="bi bi-list"></i>
                </button>
                <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                  {% if job.job_id in save_for_later %}
                    {% include 'htmx/bookmark-unmark.html' %}
                  {% else %}
                    {% include 'htmx/bookmark.html' %}
                  {% endif %}
                  
                  {% include 'htmx/report.html'%}
                </div>
              </div>
            </div>
            <div class="d-flex justify-content-start card-subtitle mb-1 text-muted">
              <a href="{% url 'userdetails' job.poster_id.id %}">
                <img src="../static/assets/pfp/{{job.poster_id.id}}.jpeg">
              </a>
              <h5><a href="{% url 'userdetails' job.poster_id.id %}">{{ job.poster_id.username }}</a></h5>
            </div>
            <p class="">{{ job.points }} Points · {{ job.posting_time | date:'d M Y' }} · {{ job.location }}</p>
            <p>{{ job.job_short_description }}</p>
            <!-- TODO: show more show less, not working properly
            <p class="short-desc" id="short-desc-{{ job.job_id }}">{{ job.job_short_description }}</p>
            <span class="long-desc" id="long-desc-{{ job.job_id }}">{{ job.job_description }}</span>
            <a onclick="showMore('{{ job.job_id }}')">read more</a>
            <br/>
            -->
            {% if job.job_id in jobs_applied %}
              {% include 'htmx/applied.html' %}
            {% else %}
              <button class="btn btn-primary"
                id="btnApply{{ job.job_id }}"
                _="on click add @disabled to me"
                hx-post="{% url 'apply' %}"
                hx-vals='{"job_id": {{ job.job_id }} }'
                hx-swap="outerHTML"
                hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'>Apply</button>
            {% endif %}
        </div>
      </div>
      {% endfor %}
    </div>
  </div>

  <button
      type="button"
      class="btn btn-danger btn-floating btn-lg"
      id="btn-back-to-top"
      >
      <i class="bi bi-arrow-up"></i>
  </button>
</div>


{{ block.super }}
<script src="{% static 'js/home.js' %}"></script>

<!-- TODO: show more show less, not working properly
<script>
  // When you click on the read more button
  function showMore(id) {
    if ($("#long-desc-"+id).is(":hidden")) {
      $("#short-desc-"+id).hide()
      $("#long-desc-"+id).show()
    }
    else {
      $("#long-desc-"+id).hide()
      $("#short-desc-"+id).show()
    }
    //$("#textcontain"+id).height("auto");//Removing the height limit on text containers
  }
</script>-->
{% endblock %}
