{% extends 'base.html' %}
{% load static %}

{% block title %}Home{% endblock %}

{% block head_extra %}
<script src="{% static 'js/htmx-1.8.5.min.js' %}" defer></script>
<script src="{% static 'js/hyperscript-0.9.7.min.js' %}" defer></script>
{% endblock %}

{% block content %}
{% include 'navigation.html' %}

<div class="container">

  <div class="hello text-center">
    <h1>Hi {{ user.username }}!</h1>
    {% if jobs_count == 0 %}
      <p>There are no available jobs with this search term.</p>
    {% elif jobs_count == 1 %}
      <p>You can see the available job here. </p>
    {% else %}
      <p>You can see the {{jobs_count}} available jobs here. </p>
    {% endif %}
    
  </div>
  <form class="searchform d-flex justify-content-center" method ="get">
    <input class="searchbar" type="text" value='{{request.GET.search_title}}' name="search_title"/>
    <button class="btn btn-primary" type="submit">Search</button>
  </form>
  <div class="row d-flex justify-content-center">
    <div class="col jobs-scroll mb-5">
      {% for job in jobs %}
        <div class="job-card container">
          <div class="d-flex justify-content-between">
            <h4><a href="{% url 'jobdetails' job.job_id %}">{{ job.job_title }}</a></h4>
            <div class="dropdown">
              <button class="btn btn-secondary dropdown-toggle" 
                type="button" id="dropdownMenuButton" data-toggle="dropdown" 
                aria-haspopup="true" aria-expanded="false">Options
              </button>
              <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                {% if job.job_id in save_for_later %}
                  {% include 'htmx/bookmark-unmark.html' %}
                {% else %}
                  {% include 'htmx/bookmark.html' %}
                {% endif %}
                {% include 'htmx/report.html'%}
              </div>
            </div>
          </div>
          <div class="d-flex justify-content-start">
            <a href="{% url 'userdetails' job.poster_id.id %}">
              <img src="../static/assets/pfp/{{job.poster_id.id}}.jpeg">
            </a>
            <h5><a href="{% url 'userdetails' job.poster_id.id %}">{{ job.poster_id.username }}</a></h5>
          </div>
          <p>{{ job.points }} Points · {{ job.posting_time | date:'d M Y' }} · {{ job.location }}</p>
          <p>{{ job.job_short_description }}</p>

          {% if job.job_id in jobs_applied %} 
            {% include 'htmx/applied.html' %}
          {% else %}
            <button class="btn btn-primary"
              id="btnApply{{ job.job_id }}"
              _="on click add @disabled to me"
              hx-post="{% url 'apply' %}"
              hx-vals='{"job_id": {{ job.job_id }} }'
              hx-swap="outerHTML"
              hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'>Apply</button>
          {% endif %}

        </div>
      {% endfor %}
    </div>
  </div>
</div>


{% endblock %}